<ion-header>

  <ion-navbar color="amazonia">
    <ion-title>Pedido</ion-title>
  </ion-navbar>
  <ion-toolbar color="amazonia">
      <ion-segment [(ngModel)]="atual" color="amazoniaText" >
        <ion-segment-button value="aba1">
         Dados Pessoais
        </ion-segment-button>
        <ion-segment-button value="aba2">
          Entrega
        </ion-segment-button>
        <ion-segment-button value="aba3">
            Pagamento
          </ion-segment-button>
      </ion-segment>
    </ion-toolbar>
</ion-header>

<ion-content class="page-checkout">
    <div [ngSwitch]="atual">
      <div *ngSwitchCase="'aba1'">
      <ion-list>
        <ion-item-divider color="dark">Dados Pessoais</ion-item-divider>
        <ion-item>
            <ion-label stacked>Nome</ion-label>
          <ion-input type="text"  [(ngModel)]="newOrder.user.firstName"></ion-input>
        </ion-item>

        <ion-item>
            <ion-label stacked>Sobre Nome</ion-label>
          <ion-input type="text"  [(ngModel)]="newOrder.user.lastName"></ion-input>
        </ion-item>

        <ion-item>
        <ion-label stacked>Email</ion-label>
        <ion-input type="email"  [(ngModel)]="newOrder.user.email"></ion-input>
        </ion-item>
        <ion-item>
            <ion-label stacked>CPF</ion-label>
            <ion-input type="number"  [(ngModel)]="newOrder.user.cpf" ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label color="amazonia" stacked>Data de Nascimento</ion-label>
          <ion-datetime doneText="OK" cancelText="Cancela" color="amazonia" displayFormat="DD/MM/YYYY" pickerFormat="DD/MM/YYYY" (ionBlur)="getDate($event)"></ion-datetime>
      </ion-item>
          
      </ion-list>      
      </div>
      <div *ngSwitchCase="'aba2'">
        <ion-list>
        <ion-item-divider color="dark">Endereço de Cobrança</ion-item-divider>
          <ion-item>
              <ion-label stacked>Rua</ion-label>
            <ion-textarea type="text"  maxlength="80" [(ngModel)]="newOrder.cardData.address.rua"></ion-textarea>
          </ion-item>
          <ion-item>
              <ion-label stacked>Numero</ion-label>
            <ion-input type="text"   [(ngModel)]="newOrder.cardData.address.numero"></ion-input>
          </ion-item>
          <ion-item>
              <ion-label stacked>Complemento</ion-label>
            <ion-textarea type="text"  maxlength="80" [(ngModel)]="newOrder.cardData.address.complemento"></ion-textarea>
          </ion-item>
          <ion-item>
              <ion-label stacked>Bairro</ion-label>
            <ion-input type="text" [(ngModel)]="newOrder.cardData.address.bairro"></ion-input>
          </ion-item>
          
          <ion-item>
            <ion-label>
              Pais
            </ion-label>
            <ion-select [(ngModel)]="newOrder.cardData.address.pais">
              <ion-option value="BRA" >Brasil</ion-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-label>Estado</ion-label>
            <ion-select [(ngModel)]="newOrder.cardData.address.estado">
              <ion-option value="PA">Pará</ion-option>
            </ion-select>
          </ion-item>
          <ion-item>
              <ion-label stacked>Cidade</ion-label>
            <ion-input type="text" [(ngModel)]="newOrder.cardData.address.cidade"></ion-input>        
          </ion-item>

          <ion-item>
              <ion-label stacked>CEP</ion-label>
            <ion-input  type="number" clearInput [(ngModel)]="newOrder.cardData.address.cep"></ion-input>        
          </ion-item>
          <ion-item>
              <ion-label stacked>DDD</ion-label>
                <ion-input  maxlength="3" type="number" clearInput [(ngModel)]="newOrder.cardData.phone.area"></ion-input>        
          </ion-item>
          <ion-item>
            <ion-label stacked>Telefone</ion-label>
            <ion-input  type="tel" maxlength="9" clearInput [(ngModel)]="newOrder.cardData.phone.number"></ion-input>        
          </ion-item>
        <ion-item>
          <ion-label>Mesmo Endereço de Entrega</ion-label>
          <ion-checkbox  [(ngModel)]="billing_shipping_same" (ionChange)="setBillingToShipping()"></ion-checkbox>
        </ion-item>
        <div *ngIf="!billing_shipping_same">
          <ion-item-divider color="dark" >Endereço de Entrega</ion-item-divider>
          <ion-item>
              <ion-label stacked>Rua</ion-label>
            <ion-textarea type="text"  maxlength="80" [(ngModel)]="newOrder.shipping.rua"></ion-textarea>
          </ion-item>
          <ion-item>
              <ion-label stacked>Numero</ion-label>
            <ion-input type="text"  [(ngModel)]="newOrder.shipping.numero"></ion-input>
          </ion-item>
          <ion-item>
              <ion-label stacked>Complemento</ion-label>
            <ion-textarea type="text"  maxlength="80" [(ngModel)]="newOrder.shipping.complemento"></ion-textarea>
          </ion-item>
          <ion-item>
              <ion-label stacked>Bairro</ion-label>
            <ion-input type="text"  [(ngModel)]="newOrder.shipping.bairro"></ion-input>
          </ion-item>
          
          <ion-item>
            <ion-label>
              Pais
            </ion-label>
            <ion-select [(ngModel)]="newOrder.shipping.pais">
              <ion-option value="BRA" selected="true">Brasil</ion-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-label>Estado</ion-label>
            <ion-select [(ngModel)]="newOrder.shipping.estado">
              <ion-option value="PA">Pará</ion-option>
            </ion-select>
          </ion-item>
          <ion-item>
              <ion-label stacked>Cidade</ion-label>
            <ion-input  type="text" [(ngModel)]="newOrder.shipping.cidade"></ion-input>        
          </ion-item>

          <ion-item>
              <ion-label stacked>CEP</ion-label>
            <ion-input  type="number" clearInput [(ngModel)]="newOrder.shipping.cep"></ion-input>        
          </ion-item>

          <ion-item>
            <ion-label stacked>DDD</ion-label>
            <ion-input maxlength="3" type="number" clearInput [(ngModel)]="newOrder.shipping.phone.area"></ion-input>        
          </ion-item>
          <ion-item>
              <ion-label stacked>Telefone</ion-label>
              <ion-input  type="tel" maxlength="9" clearInput [(ngModel)]="newOrder.shipping.phone.number"></ion-input>        
          </ion-item>
        </div>
        </ion-list>
        <ion-item-divider color="dark">Forma de Envio</ion-item-divider>
        <div class="formasPagamento">
            <div *ngIf="newOrder.valorEntrega > 0">
                <ion-grid >
                  <ion-row>
                     <ion-col col-6 style="text-align:left !important;">
                         <b>Valor:</b>
                      </ion-col>
                      <ion-col col-6 style="text-align:right !important;">
                         <b>{{newOrder.valorEntrega.toFixed(2)}}</b>
                      </ion-col>
                  </ion-row>
                  <ion-row>
                     <ion-col col-6 style="text-align:left !important;">
                         <b>Prazo:</b>
                      </ion-col>
                      <ion-col col-6 style="text-align:right !important;">
                         <b>{{this.newOrder.prazoEntrega}} Dias</b>
                      </ion-col>
                  </ion-row>
                </ion-grid>
               </div>
            <ion-list radio-group [(ngModel)]="shippingMethod" (ionChange)="calculateShipment()">
            <ion-grid>
              <ion-row>
                <ion-col col-6>
                  <ion-row>
                      <ion-icon large color="amazonia" name="cube"></ion-icon>
                  </ion-row>
                  <ion-row>
                    <ion-col col-10>
                      <ion-label>Correios PAC</ion-label>
                    </ion-col>
                    <ion-col col-2 style="padding-top: 16px;">
                      <ion-radio color="amazonia" value="pac" checked="true"></ion-radio>
                    </ion-col>
                  </ion-row>
                </ion-col>
                
                <ion-col col-6>
                  <ion-row>
                    <ion-icon large color="amazonia" name="cube"></ion-icon>
                  </ion-row>
                  <ion-row>
                    <ion-col col-10>
                      <ion-label>Correios SEDEX</ion-label>
                    </ion-col>
                    <ion-col col-2 style="padding-top: 16px;">
                      <ion-radio color="amazonia" value="sedex" ></ion-radio>
                    </ion-col>
                </ion-row>
                </ion-col>
              </ion-row>
              
            </ion-grid>
            </ion-list>
        
          </div>     
      </div>
    <div *ngSwitchCase="'aba3'">
      <ion-list>
        <ion-item-divider color="dark">Forma de Pagamento</ion-item-divider>
        <div class="formasPagamento" *ngIf="paymentMethod.payment_id =='nan'">
        <ion-grid>
          <ion-row>
            <ion-col col-6 (click)="setPaymentMethod('card')">
              <ion-row>
                  <ion-icon large color="amazonia" name="ios-card"></ion-icon>
              </ion-row>
              <ion-row>
                  <p>Cartão de Crédito</p>
              </ion-row>
            </ion-col>
            
            <ion-col col-6 (click)="setPaymentMethod('boleto')" >
              <ion-row>
                <ion-icon large color="amazonia" name="document"></ion-icon>
              </ion-row>
              <ion-row>
              <p>Boleto Bancário</p>
            </ion-row>
            </ion-col>
          </ion-row>
          
        </ion-grid>
      </div>
      <div *ngIf="paymentMethod.cardNumber">
        
        <ion-list>
          <ion-item>
              <ion-thumbnail *ngIf="cardBrandImage" item-end style="min-width : 72px  !important; min-height:0px !important; ">
                <img [src]="cardBrandImage" style="width:auto !important; height: auto !important; ">
              </ion-thumbnail>
            <ion-label>{{paymentMethod.cardNumber}} </ion-label>            
          </ion-item>
          <ion-item>
              <ion-label>CVV :</ion-label>
              <ion-label>{{paymentMethod.cardCVV}}</ion-label>
          </ion-item>
          <ion-item>
            <ion-label>Validade :</ion-label>
              <ion-label>{{paymentMethod.cardExpMonth}}/{{paymentMethod.cardExpYear}}</ion-label>            
            </ion-item>
            <ion-item>
                <ion-label>Parcelas :</ion-label>
                  <ion-label>{{paymentMethod.parcela.quantity}} x {{paymentMethod.parcela.installmentAmount}} {{paymentMethod.parcela.interestFree ? ' S/Juros' : ' C/Juros'}}</ion-label>            
                </ion-item>
        </ion-list>
        <button ion-button block outline color="dark" (click)="paymentMethod.cardNumber = null ; paymentMethod.payment_id = 'nan'" >Trocar Forma Pagamento </button>
      </div>
      <div *ngIf="paymentMethod.payment_id == 'boleto'">
          <ion-item>
              <ion-label>CPF :</ion-label>
              <ion-label>{{newOrder.user.cpf}}</ion-label>            
          </ion-item>
          <button ion-button block outline color="dark" (click)="paymentMethod.payment_id = 'nan' " >Trocar Forma Pagamento </button>
      </div>
       
        </ion-list>
        
      
      </div>
  
  </div>
  <div style="height: 50px; text-align: center;"></div>
</ion-content>
<ion-footer>
    <div [ngSwitch]="atual">
        <div *ngSwitchCase="'aba1'">
          <button ion-button block color="amazonia" (click)="atual = 'aba2' ">Continuar</button>
        </div>
        <div *ngSwitchCase="'aba2'">
            <button ion-button block color="amazonia" (click)="atual='aba3'">Continuar</button>
            <button ion-button block outline color="dark" (click)="atual= 'aba1' ">Voltar</button>
        </div>
        <div *ngSwitchCase="'aba3'">
            <button ion-button block color="amazonia" (click)="placeOrder()">Continuar</button>
            <button ion-button block outline color="dark" (click)="atual= 'aba2' ">Voltar</button>
        </div>  
    </div>
    <div style="height: 17px; text-align: center;"><ion-note>Pagamento Processado por PagSeguro </ion-note></div>
</ion-footer>
